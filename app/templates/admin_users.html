{% extends "base.html" %}
{% block top_right %}
  <a class="btn" href="/">Home</a>
  <a class="btn" href="/admin/conversations">Conversations</a>
  <a class="btn" href="/admin/rerun-queue">Rerun Queue</a>
{% endblock %}
{% block content %}
<div class="card">
  <div class="card-h">Users</div>
  <div class="card-b tablewrap">
    <table style="min-width:980px;">
      <thead>
        <tr>
          <th>last seen</th>
          <th>icon</th>
          <th>name</th>
          <th>event</th>
          <th>userId</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      {% if users|length == 0 %}
        <tr><td colspan="6" class="muted">まだ0件（Webhookを一度当ててください）</td></tr>
      {% endif %}
      {% for u in users %}
        <tr>
          <td class="muted">{{ u.last_seen_at.strftime("%Y-%m-%d %H:%M:%S") if u.last_seen_at else "" }}</td>
          <td>
            {% if u.picture_url %}
              <img class="avatar" src="{{ u.picture_url }}" style="width:36px;height:36px;">
            {% else %}
              <span class="chip">?</span>
            {% endif %}
          </td>
          <td><strong>{{ u.user_name or "unknown" }}</strong></td>
          <td class="muted">{{ u.last_event or "" }}</td>
          <td class="mono muted" style="font-size:12px;">{{ u.user_id }}</td>
          <td><a class="btn" href="/admin/users/{{ u.user_id }}/tasks">Tasks</a></td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
