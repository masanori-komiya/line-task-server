{% extends "base.html" %}

{% block top_right %}
  <a class="btn" href="/admin/users">Users</a>
  <a class="btn" href="/admin/conversations">Conversations</a>
  <a class="btn" href="/admin/tasks">All Tasks</a>
  <a class="btn" href="/admin/task-runs.csv">CSV Download</a>
  <a class="btn" href="/admin/rerun-queue">Rerun Queue</a>
  <a class="btn" href="/">Home</a>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-h">Task Runs <span class="muted" style="font-weight:600;">(last {{ retention_days }} days / showing latest {{ limit }})</span></div>
  <div class="card-b">
    <div class="muted" style="margin-bottom:10px;">
      CSV is also limited to the last {{ retention_days }} days.
    </div>
    <div class="tablewrap">
      <table>
        <thead>
          <tr>
            <th>Started</th>
            <th>Status</th>
            <th>Task</th>
            <th>User</th>
            <th>Runner</th>
            <th>Exit</th>
            <th>Finished</th>
            <th>Run ID</th>
          </tr>
        </thead>
        <tbody>
        {% for r in runs %}
          <tr>
            <td class="mono">{{ r.started_at }}</td>
            <td>{{ r.status }}</td>
            <td>
              <div style="font-weight:800;">{{ r.task_name or "(deleted)" }}</div>
              <div class="muted mono" style="font-size:12px;">{{ r.task_id }}</div>
            </td>
            <td>
              <div style="font-weight:800;">{{ r.user_name or "(unknown)" }}</div>
              <div class="muted mono" style="font-size:12px;">{{ r.user_id }}</div>
            </td>
            <td class="mono">{{ r.runner_id or "" }}</td>
            <td class="mono">{{ r.exit_code if r.exit_code is not none else "" }}</td>
            <td class="mono">{{ r.finished_at or "" }}</td>
            <td class="mono" style="font-size:12px;">{{ r.run_id }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
